


<div class="container-fluid">
  <% x = 0 %>
  <% y = 0 %>
    <% @fams.each do |family| %>
      <% x += 1 %>
      <% y += 1 %>
      <div class="row">
        <div class="col-md-3"><%= image_tag("#{family.housepic}", width: '100%' ) %></div>
        <div class="col-md-9">

          <% if @current_user != nil %>
            <h3><%= link_to(family.tagline, showfam_path(family))  %></h3>
          <% else %>
            <h3><%= link_to family.tagline, "#", data: {toggle: "modal", target: "#myModal#{y}"} %></h3>
          <% end %>

          <br>
          <%= family.city %>,
          <%= family.country %>

          <div class="right-align">

            <% if @current_user != nil %>

              <% @saved = @current_user.saves.where(id: family.id) %>

              <% if @saved.exists? %>

              <%= form_tag users_unsavefam_path do %>
                <%= hidden_field_tag(:family_id, family.id) %>
                <%= submit_tag("Unsave") %>
              <% end %>

              <% else %>

                <%= form_tag users_savefam_path do %>
                  <%= hidden_field_tag(:family_id, family.id) %>
                  <%= submit_tag("Save") %>
                <% end %>

              <% end %>

              <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#myModal<%= x %>">
                Connect!
              </button>

              <div class="modal fade" id="myModal<%= x %>" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                      <h4 class="modal-title" id="myModalLabel">Connect with this family from <%= family.country %>!</h4>
                    </div>
                    <div class="modal-body">
                      This family will receive an email from you that looks like this:<br><br>

                      Subject: <%= @current_user.name %> from <%= @current_user.country %> wishes to connect!<br><br>

                      The body of the email will be whatever you enter below!<br>



                      <%= form_tag users_connect_path do %>
                        <textarea rows="10" cols="75" name="content" placeholder="Hint: Friendlyness of connection email and connection success are directly correlated!"></textarea>
                        <%= hidden_field_tag 'user_id', @current_user.id %>
                        <%= hidden_field_tag 'fam_id', family.id %>
                        <br>
                        <%= submit_tag 'Send!' %>
                      <% end %>

                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                  </div>
                </div>
              </div>

            <% else %>

            <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#myModal<%= y %>">
              Save
            </button>
            <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#myModal<%= y %>">
              Connect!
            </button>


            <div class="modal fade" id="myModal<%= y %>" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Please Log In or Sign Up for "View", "Save" and "Connect" features</h4>
                  </div>
                  <div class="modal-body">
                    <a class="btn btn-primary btn-lg btn-block" href="/users/loginpage" role="button">Log In</a><br><br>
                    <a class="btn btn-primary btn-lg btn-block" href="/users/signup" role="button">Sign Up!</a>

                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                  </div>
                </div>
              </div>
            </div>



            <% end %>



          </div>
        </div>

      </div><br>
    <% end %>
</div>
