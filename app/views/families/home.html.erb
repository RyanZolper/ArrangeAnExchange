


<div class="container-fluid">
  <% x = 0 %>
  <% y = 0 %>
    <% @fams.each do |family| %>
      <% x += 1 %>
      <% y += 1 %>
      <div class="row">

        <div class="col-md-2" style="height:100%">
          <div class="row" style="height:100%">
            <div class="col-md-12" style="height:100%">
              <%= image_tag("#{family.housepic.bigthumb}", class: "img-rounded", id: "thumb-lg", width: '100%' ) %>
            </div>
          </div>
        </div>
        <div class="col-md-10">
          <% if @current_user != nil %>
            <w2><%= link_to(family.tagline, showfam_path(family), style: "color:#428BCA;weight:bold;")  %></w2>
          <% else %>
            <w2><%= link_to family.tagline, "#", {data: {toggle: "modal", target: "#nouserModal"}, style: "color:#428BCA;weight:bold;"} %></w2>
          <% end %>
          <div class="row">
          <div class="col-md-5">
            <w3><%= family.city %>,
            <%= family.country %><br>
            <%= family.size %> family members<br>
            <%= family.beds %> beds,
            <%= family.baths %> baths</w3>
          </div>

          <div class="col-md-3" style="text-align:center;">
            <div class="stars">
            <% @v = 1 %>
            <% @rate20 = (((family.hosteds.average(:hoststars).to_f) * 4).to_i) %>
            <% 20.times do %>
                <% if @rate20 == @v %>
                  <% @c = ' checked="checked"' %>
                <% end %>

                <input class="star" type="radio" name="famrating<%= x %>" value=<%= @v %> disabled="disabled"<%= @c %>/>
                <% @v += 1 %>
                <% @c = nil %>
              <% end %>
              <% @v = 0 %>
            </div><br>
            <w3>Host Rating: <%= (family.hosteds.average(:hoststars).to_f) %>/5<br>(<%= family.hosteds.count %> reviews)</w3>
          </div>

        <div class="col-md-4">

            <% if @current_user != nil %>
            <% @fam = family %>

            <div id="save_unsave<%= @fam.id %>">
              <%= render 'save_unsave' %>
            </div>
            <br>
              <button type="button" class="btn btn-primary btn-lg btn-block" id="connect" data-toggle="modal" data-target="#myModal<%= x %>">
                Connect!
              </button>

              <div class="modal fade" id="myModal<%= x %>" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div style="text-align:center;" class="modal-dialog modal-lg">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                      <w2 class="modal-title" id="myModalLabel">Connect with this family in <%= family.country %>!</w2>
                    </div>
                    <div class="modal-body">
                      <w3>This family will receive an email from you that looks like this:</w3><br><br>

                      <w4>Subject: <%= @current_user.name %> from <%= @current_user.country %> wishes to connect!<br><br>

                      The body of the email will be whatever you enter below!<br>



                      <%= form_tag users_connect_path do %>
                        <textarea rows="10" cols="75" name="content" placeholder="Hint: Friendlyness of connection email and connection success are directly correlated!"></textarea>
                      </w4><%= hidden_field_tag 'user_id', @current_user.id %>
                        <%= hidden_field_tag 'fam_id', family.id %>
                        <br>
                        <div style="width:70%;margin:auto;">
                          <%= submit_tag 'Send!', {class: "btn btn-primary btn-block btn-lg", style: "font-size:30px;"} %>
                        </div>
                      <% end %>

                    </div>
                  </div>
                </div>
              </div>

            <% else %>

            <button type="button" class="btn btn-primary btn-lg btn-block" data-toggle="modal" data-target="#nouserModal">
              Save
            </button><br>
            <button type="button" class="btn btn-primary btn-lg btn-block" data-toggle="modal" data-target="#nouserModal">
              Connect!
            </button>



            <% end %>


          </div>
          </div>
        </div>
      </div>
    <% end %>

    <div class="modal fade" id="nouserModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header" style="text-align:center">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <w3 class="modal-title" id="myModalLabel">Please Log In or Sign Up for "View", "Save" and "Connect" features</w3>
          </div>
          <div class="modal-body">
            <div class="row" style="text-align:center">
              <div class="col-md-6" style="border-right:2px;">
                <w3>Join Now To Start Your Adventure!</w3><br><br>

                <%= form_for @user, url: {controller: "users", action: "create"} do |f| %>

                  <div class="field">
                    <w3><%= f.label :name %></w3><br>
                    <%= f.text_field :name, class: "form-control" %>
                  </div><br>

                  <div class="field">
                    <w3><%= f.label "Country of Residence" %></w3><br>
                    <%= f.text_field :country, class: "form-control" %>
                  </div><br>

                  <div class="field">
                    <w3><%= f.label :email %></w3><br>
                    <%= f.text_field :email, class: "form-control" %>
                  </div>
                    <div class="actions">
                      <%= f.hidden_field(:password, :value => @temp ) %>
                      <%= f.hidden_field(:password_confirmation, :value => @temp ) %>
                      <%= f.submit nil, id: "submit-signup", class: "hidden" %>
                    </div>

                  <%= hidden_field_tag(:temp, @temp) %>

                <% end %>
              </div>
              <div class="col-md-6">
                <w3>Log In to Continue</w3>
                <br><br><br><br>
                <%= form_for @user, url: {controller: "users", action: "login"} do |f| %>

                  <div class="field">
                    <w3><%= f.label :email %></w3><br>
                    <%= f.search_field :email, class: "form-control" %>
                  </div><br><br>

                  <div class="field">
                    <w3><%= f.label :password %></w3><br>
                    <%= f.password_field :password, class: "form-control" %>
                  <div class="actions">
                    <%= f.submit nil, id: "submit-login", class: "hidden" %>
                  </div>

                <% end %>
              </div>
            </div>
          </div>

          <div class="modal-footer">
            <div class="row">
              <div class="col-md-6">
                <label for="submit-signup" class="btn btn-primary btn-block btn-lg">Sign Up!</label>
              </div>
              <div class="col-md-6">
                <label for="submit-login" class="btn btn-primary btn-block btn-lg">Log In</label>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>


</div>
<div class="center">
  <%= paginate @fams %>
</div>
